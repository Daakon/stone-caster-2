entities:
  AdventureLegacy:
    table: adventures_legacy
    fields:
      id: uuid
      slug: string
      title: string
      description: text
      world_slug: string
      tags: jsonb
      scenarios: jsonb
      is_active: boolean
      created_at: timestamptz
      updated_at: timestamptz
    relationships:
      - type: one-to-many
        target: games
        field: adventure_id
    usage:
      - frontend: Adventure listing pages
      - api: Legacy adventure endpoints
      - admin: Adventure management

  AdventureAWF:
    table: adventures
    fields:
      id: text
      world_ref: text
      version: text
      doc: jsonb
      hash: text
      created_at: timestamptz
      updated_at: timestamptz
    relationships:
      - type: many-to-one
        target: worlds
        field: world_ref
    usage:
      - frontend: AWF adventure admin
      - api: AWF adventure endpoints
      - prompts: Adventure prompt assembly

  Scenario:
    table: scenarios
    fields:
      id: text
      version: text
      doc: jsonb
      created_at: timestamptz
      updated_at: timestamptz
    relationships:
      - type: many-to-one
        target: worlds
        field: world_ref
        source: doc->>'world_ref'
      - type: many-to-one
        target: adventures
        field: adventure_ref
        source: doc->>'adventure_ref'
    usage:
      - frontend: Scenario picker
      - api: Scenario endpoints
      - prompts: Scenario prompt assembly

  World:
    table: worlds
    fields:
      id: text
      version: text
      doc: jsonb
      hash: text
      created_at: timestamptz
      updated_at: timestamptz
    relationships:
      - type: one-to-many
        target: adventures
        field: world_ref
      - type: one-to-many
        target: scenarios
        field: world_ref
        source: doc->>'world_ref'
    usage:
      - frontend: World selection
      - api: World endpoints
      - prompts: World prompt assembly

  Game:
    table: games
    fields:
      id: uuid
      adventure_id: uuid
      character_id: uuid
      user_id: uuid
      cookie_group_id: uuid
      world_slug: string
      state_snapshot: jsonb
      turn_count: integer
      status: string
      created_at: timestamptz
      updated_at: timestamptz
      last_played_at: timestamptz
    relationships:
      - type: many-to-one
        target: adventures_legacy
        field: adventure_id
      - type: many-to-one
        target: characters
        field: character_id
      - type: many-to-one
        target: auth.users
        field: user_id
      - type: many-to-one
        target: cookie_groups
        field: cookie_group_id
    usage:
      - frontend: Game interface
      - api: Game management
      - state: Game state tracking

  Turn:
    table: turns
    fields:
      id: uuid
      game_id: uuid
      option_id: uuid
      ai_response: jsonb
      created_at: timestamptz
    relationships:
      - type: many-to-one
        target: games
        field: game_id
    usage:
      - frontend: Turn history
      - api: Turn processing
      - state: Game progression

  Character:
    table: characters
    fields:
      id: uuid
      active_game_id: uuid
      user_id: uuid
      world_slug: string
      name: string
      description: text
      stats: jsonb
      created_at: timestamptz
      updated_at: timestamptz
    relationships:
      - type: many-to-one
        target: games
        field: active_game_id
      - type: many-to-one
        target: auth.users
        field: user_id
    usage:
      - frontend: Character selection
      - api: Character management
      - state: Character data

  ScenarioDocument:
    type: jsonb
    structure:
      world_ref: string
      adventure_ref: string
      is_public: boolean
      scenario:
        display_name: string
        synopsis: string
        start_scene: string
        fixed_npcs: array
        starting_party: array
        starting_inventory: array
        starting_resources: object
        starting_flags: object
        starting_objectives: array
        tags: array
        slices: array
        i18n: object
    usage:
      - frontend: Scenario display
      - api: Scenario data
      - prompts: Scenario context

  AdventureDocument:
    type: jsonb
    structure:
      id: string
      name: string
      version: string
      world_ref: string
      synopsis: string
      cast: array
      slices: array
      i18n: object
    usage:
      - frontend: Adventure display
      - api: Adventure data
      - prompts: Adventure context

  WorldDocument:
    type: jsonb
    structure:
      id: string
      name: string
      version: string
      description: string
      lore: string
      rules: object
      npcs: array
      locations: array
      items: array
      i18n: object
    usage:
      - frontend: World display
      - api: World data
      - prompts: World context


