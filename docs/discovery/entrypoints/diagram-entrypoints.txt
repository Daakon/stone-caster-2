# Entry Points Relationship Diagram

## Current System Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        ENTRY POINTS                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐ │
│  │   ADVENTURES    │    │   SCENARIOS      │    │   SANDBOX    │ │
│  │                 │    │                 │    │             │ │
│  │ Legacy Table:   │    │ AWF Table:      │    │ (Planned)   │ │
│  │ - adventures    │    │ - scenarios     │    │ - TBD       │ │
│  │ - UUID PK       │    │ - TEXT PK       │    │             │ │
│  │ - Simple fields │    │ - JSONB doc     │    │             │ │
│  │                 │    │                 │    │             │ │
│  │ AWF Table:      │    │ Fields:         │    │             │ │
│  │ - adventures    │    │ - id, version   │    │             │ │
│  │ - TEXT PK       │    │ - doc (JSONB)   │    │             │ │
│  │ - JSONB doc     │    │ - world_ref     │    │             │ │
│  │                 │    │ - adventure_ref │    │             │ │
│  └─────────────────┘    └─────────────────┘    └─────────────┘ │
│           │                       │                       │     │
│           │                       │                       │     │
│           └───────────────────────┼───────────────────────┘     │
│                                   │                             │
│  ┌─────────────────────────────────┼─────────────────────────┐   │
│  │            WORLDS              │                         │   │
│  │                                 │                         │   │
│  │ AWF Table: worlds               │                         │   │
│  │ - id, version                   │                         │   │
│  │ - doc (JSONB)                  │                         │   │
│  │ - hash                         │                         │   │
│  └─────────────────────────────────┼─────────────────────────┘   │
│                                   │                             │
│  ┌─────────────────────────────────┼─────────────────────────┐   │
│  │            GAMES                │                         │   │
│  │                                 │                         │   │
│  │ - id (UUID)                     │                         │   │
│  │ - adventure_id (FK)             │                         │   │
│  │ - character_id (FK)             │                         │   │
│  │ - world_slug                    │                         │   │
│  │ - state_snapshot (JSONB)        │                         │   │
│  │ - turn_count                    │                         │   │
│  │ - status                        │                         │   │
│  └─────────────────────────────────┼─────────────────────────┘   │
│                                   │                             │
│  ┌─────────────────────────────────┼─────────────────────────┐   │
│  │            PROMPTS              │                         │   │
│  │                                 │                         │   │
│  │ - id, slug, scope               │                         │   │
│  │ - version, content              │                         │   │
│  │ - active, metadata              │                         │   │
│  └─────────────────────────────────┼─────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

## Proposed Unified System

```
┌─────────────────────────────────────────────────────────────────┐
│                    UNIFIED ENTRY POINTS                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                ENTRY_POINTS TABLE                          │ │
│  │                                                             │ │
│  │ Core Fields:                                                │ │
│  │ - id, slug, type                                           │ │
│  │ - title, subtitle, description                             │ │
│  │ - world_id, adventure_id, scenario_id                      │ │
│  │ - version, status, visibility                              │ │
│  │ - content_rating, age_rating                               │ │
│  │ - thumbnail_url, cover_url                                 │ │
│  │ - tags, categories                                         │ │
│  │ - search_text, sort_weight, popularity_score               │ │
│  │ - content (JSONB)                                          │ │
│  │ - i18n (JSONB)                                             │ │
│  │ - timestamps, ownership                                    │ │
│  │                                                             │ │
│  │ Type-Specific Content:                                     │ │
│  │ - adventure: storyline, cast, locations, rules             │ │
│  │ - scenario: start_scene, initial_conditions, objectives    │ │
│  │ - sandbox: world_settings, constraints, tools              │ │
│  │ - quest: objectives, rewards, prerequisites                │ │
│  └─────────────────────────────────────────────────────────────┘ │
│           │                                                     │
│           │                                                     │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    WORLDS TABLE                             │ │
│  │                                                             │ │
│  │ - id, version                                               │ │
│  │ - doc (JSONB)                                               │ │
│  │ - hash                                                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
│           │                                                     │
│           │                                                     │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    GAMES TABLE                              │ │
│  │                                                             │ │
│  │ - id (UUID)                                                 │ │
│  │ - entry_point_id (FK)                                      │ │
│  │ - entry_point_type                                         │ │
│  │ - character_id (FK)                                        │ │
│  │ - world_id (FK)                                            │ │
│  │ - state_snapshot (JSONB)                                   │ │
│  │ - turn_count, status                                       │ │
│  └─────────────────────────────────────────────────────────────┘ │
│           │                                                     │
│           │                                                     │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    PROMPTS TABLE                            │ │
│  │                                                             │ │
│  │ - id, slug, scope                                          │ │
│  │ - version, content                                         │ │
│  │ - active, metadata                                         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘

## Data Flow Relationships

```
USER SELECTION
       │
       ▼
┌─────────────┐
│ Entry Point │ ──┐
│ Picker      │   │
└─────────────┘   │
       │           │
       ▼           │
┌─────────────┐   │
│ Game Start  │   │
│ API         │   │
└─────────────┘   │
       │           │
       ▼           │
┌─────────────┐   │
│ Game State  │   │
│ Creation    │   │
└─────────────┘   │
       │           │
       ▼           │
┌─────────────┐   │
│ Prompt      │   │
│ Assembly    │   │
└─────────────┘   │
       │           │
       ▼           │
┌─────────────┐   │
│ AI          │   │
│ Generation  │   │
└─────────────┘   │
       │           │
       ▼           │
┌─────────────┐   │
│ Chat        │   │
│ Interface   │   │
└─────────────┘   │
       │           │
       └───────────┘
```

## API Endpoint Relationships

```
┌─────────────────────────────────────────────────────────────────┐
│                        API LAYER                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐ │
│  │   PUBLIC API    │    │   ADMIN API     │    │  GAME API   │ │
│  │                 │    │                 │    │             │ │
│  │ GET /entry-     │    │ POST /admin/    │    │ POST /games │ │
│  │ points          │    │ entry-points    │    │ /start      │ │
│  │                 │    │                 │    │             │ │
│  │ GET /entry-     │    │ PUT /admin/     │    │ POST /games │ │
│  │ points/:id      │    │ entry-points/  │    │ /:id/turns  │ │
│  │                 │    │ :id             │    │             │ │
│  │ POST /games/    │    │                 │    │             │ │
│  │ start           │    │                 │    │             │ │
│  └─────────────────┘    └─────────────────┘    └─────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## Frontend Component Relationships

```
┌─────────────────────────────────────────────────────────────────┐
│                     FRONTEND LAYER                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐ │
│  │   PLAYER UI     │    │   ADMIN UI      │    │  GAME UI    │ │
│  │                 │    │                 │    │             │ │
│  │ EntryPointPicker│    │ EntryPointAdmin │    │ GamePage    │ │
│  │ - List view     │    │ - CRUD ops      │    │ - Chat       │ │
│  │ - Search/Filter │    │ - JSON editor   │    │ - Choices    │ │
│  │ - Selection     │    │ - Validation    │    │ - History    │ │
│  │                 │    │                 │    │             │ │
│  │ EntryPointCard  │    │ EntryPointForm  │    │ TurnDisplay │ │
│  │ - Display       │    │ - Edit          │    │ - AI Response│ │
│  │ - Actions       │    │ - Save          │    │ - User Input │ │
│  └─────────────────┘    └─────────────────┘    └─────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```







